<!DOCTYPE project>
<project name="pandd_build_impl" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
    	Implementation from Setup file for Pandd Framework Developing
    	(there are nothing to configure in this file)
    </description>

	<taskdef resource="net/sf/antcontrib/antlib.xml"/>
		
    <property name="parentpomentry">
	 	<![CDATA[
	      <parent>
	      	<groupId>${parent-pom_groupId}</groupId>
	      	<artifactId>${parent-pom_artifactId}</artifactId>
	      	<version>${parent-pom_version}</version>
	      </parent>
		]]>
    </property>
	
	<if>
		<equals arg1="${mvn_download_repo}" arg2="${mvn_snapshot_download_repo}"/>
		<then>
			<property name="mix_snapshot_release" value="true" />
		</then>
		<else>
			<property name="mix_snapshot_release" value="false" />
		</else>
	</if>
	
	<property name="repo-settings">
	 	<![CDATA[
    	   <repositories>
    	         <repository>
    	               <id>php-release</id>
    	               <url>${mvn_download_repo}</url>
    	               <snapshots>
    	                     <enabled>${mix_snapshot_release}</enabled>
    	               </snapshots>
    	         </repository>
    	         <repository>
    	               <id>php-snapshots</id>
    					<url>${mvn_snapshot_download_repo}</url>
    	               <releases>
    	                     <enabled>${mix_snapshot_release}</enabled>
    	               </releases>
    	         </repository>
    	   </repositories>
    		
    		<distributionManagement>  
    			<repository>
    			  <id>upload-server</id>
    			  <name>user specified upload repo</name>
    				<url>${mvn_upload_repo}</url>
    			  <layout>default</layout>
    			</repository>
    			<snapshotRepository>
    			    <id>snapshot-upload-server</id>
    			    <name>user specified snapshot upload repo</name>
    				<url>${mvn_snapshot_upload_repo}</url>
    			    <layout>default</layout>
    			    <uniqueVersion>false</uniqueVersion>
    			</snapshotRepository>
    	  </distributionManagement>
		]]>
    </property>
	
    <!-- Betriebssystemunabhaengige Loesung finden -->
    <exec executable="sed" inputstring="${project_groupId}" outputproperty="project_groupId_as_path">
      <arg value="s/\./\//g"/>
    </exec>
    	
	<target name="setup" depends="_copy_skeleton, _create_package_folders, _copy_pom, _insert_parent-pom, _insert_repo-settings, _remove_unset_tokens, _copy_build-interface, _load_dependencies">
		<!-- move pandd into lib-folder -->
		<!-- copy skeleton -->
		<!-- create src/groupId/artifactId -->
		<!-- create test/groupId/artifactId -->
		<!-- copy pom -->
		<!-- copy framework build-inteface -->
	</target>
	
	<target name="_copy_skeleton">
		<defaultexcludes remove="**/.gitignore"/>
		<copy todir=".">
		    <fileset dir="lib/${arche_groupIdAsPath}/${arche_artifactId}/skeleton" includes="**/*" />
		</copy>
		<chmod file="resources/syntax_check.sh" perm="755"/>
		<chmod file="resources/phpunit.php" perm="755"/>
		<defaultexcludes add="**/.gitignore"/>
	</target>
	
	<target name="_create_package_folders">
		<mkdir dir="src/${project_groupId_as_path}/${project_artifactId}" />
		<mkdir dir="test/${project_groupId_as_path}/${project_artifactId}" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="src/${project_groupId_as_path}/${project_artifactId}/.gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="test/${project_groupId_as_path}/${project_artifactId}/.gitignore" />
	</target>

    <target name="_copy_pom">
        <copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/pom_dist.xml" tofile="pom.xml" />
        <replace file="pom.xml" token="@add_project_artifacId_here@" value="${project_artifactId}"/>
        <replace file="pom.xml" token="@add_project_groupId_here@" value="${project_groupId}"/>
        <replace file="pom.xml" token="@add_project_version_here@" value="${project_version}"/>
    </target>
	
    <target name="_insert_parent-pom" if="${use_parent-pom}">
    	<replace file="pom.xml" value="${parentpomentry}" token="&lt;!-- @add_parent_pom_here@ --&gt;" />
    </target>
	
    <target name="_insert_repo-settings" if="${add_repo_config}">
    	<replace file="pom.xml" value="${repo-settings}" token="&lt;!-- @add_repo_settings_here@ --&gt;" />
    </target>
	
	<target name="_remove_unset_tokens">
    	<replace file="pom.xml" value="" token="&lt;!-- @add_parent_pom_here@ --&gt;" />
    	<replace file="pom.xml" value="" token="&lt;!-- @add_repo_settings_here@ --&gt;" />
	</target>
	
	<target name="_copy_build-interface">
        <copy file="lib/de/bgeb/pandd/core/build-interface.xml" tofile="build.xml" />
        <replace file="build.xml" token="@add_project_name_here@" value="${project_artifactId}"/>
        <replace file="build.xml" token="@add_arche-package_here@" value="lib/${arche_groupIdAsPath}/${arche_artifactId}"/>
	</target>

	<target name="_load_dependencies">
		<ant antfile="build.xml" target="update-dependencies" />
	</target>
</project>