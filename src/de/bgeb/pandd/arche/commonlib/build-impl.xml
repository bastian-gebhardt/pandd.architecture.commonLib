<!DOCTYPE project>
<project name="pandd_build_impl" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
    	Implementation from Build file for Pandd Framework Developing
    </description>

	<!-- hier muss die selbe pandd-Version definiert werden, wie in der pom.xml -->
	<property name="pandd.framework.version" value="0.2.0-SNAPSHOT" />
	
	<!-- (there are nothing to configure under this line) -->
	
    <!-- Betriebssystemunabhaengige Loesung finden -->
    <exec executable="sed" inputstring="${project_groupId}" outputproperty="project_groupId_as_path">
      <arg value="s/\./\//g"/>
    </exec>
    	
	<target name="setup" depends="_copy_skeleton, _create_packages, _copy_pom, _copy_build-interface">
		<!-- move pandd into lib-folder -->
		<!-- copy skeleton -->
		<!-- create src/groupId/artifactId -->
		<!-- create test/groupId/artifactId -->
		<!-- copy pom -->
		<!-- copy framework build-inteface -->
	</target>
	
	<target name="_copy_skeleton">
		<copy todir=".">
		    <fileset dir="lib/${arche_groupIdAsPath}/${arche_artifactId}/skeleton" includes="**/*" />
		</copy>
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/gitignore" tofile=".gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="lib/.gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="dist/compiled/.gitignore" />
	</target>
	
	<target name="_create_packages">
		<mkdir dir="src/${project_groupId_as_path}/${project_artifactId}" />
		<mkdir dir="test/${project_groupId_as_path}/${project_artifactId}" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="src/${project_groupId_as_path}/${project_artifactId}/.gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="test/${project_groupId_as_path}/${project_artifactId}/.gitignore" />
	</target>

    <target name="_copy_pom">
        <copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/pom_example.xml" tofile="pom.xml" />
        <replace file="pom.xml" token="@add_project_artifacId_here@" value="${project_artifactId}"/>
        <replace file="pom.xml" token="@add_project_groupId_here@" value="${project_groupId}"/>
        <replace file="pom.xml" token="@add_project_version_here@" value="${project_version}"/>
    	<replace file="pom.xml" token="@add_download_url_here@" value="${mvn_download_repo}"/>
        <replace file="pom.xml" token="@add_upload_url_here@" value="${mvn_upload_repo}"/>
    	<replace file="pom.xml" token="@add_snapshot_download_url_here@" value="${mvn_snapshot_download_repo}"/>
    	<replace file="pom.xml" token="@add_snapshot_upload_url_here@" value="${mvn_snapshot_upload_repo}"/>
    </target>
	
	<target name="_copy_build-interface">
        <copy file="lib/de/bgeb/pandd/framework/build-interface.xml" tofile="build.xml" />
        <replace file="build.xml" token="@add_project_name_here@" value="${project_artifactId}"/>
        <replace file="build.xml" token="@add_arche-package_here@" value="lib/${arche_groupIdAsPath}/${arche_artifactId}"/>
        <replace file="build.xml" token="@add_pandd-framework-version_here@" value="${pandd.framework.version}"/>
	</target>

	
	
	<target name="_load_pom-file">
		<artifact:pom id="pomfile" file="pom.xml" />
	</target>
	
    <target name="clean_dist">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="dist/compiled" includes="**/*" excludes=".gitignore" />
            <fileset dir="dist" includes="**/*" excludes="compiled/*" />
        </delete>
        <defaultexcludes add="**/.gitignore"/>
    </target> 
    
    <target name="clean_lib">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="lib" includes="**/*" excludes=".gitignore" />
        </delete>       
        <defaultexcludes add="**/.gitignore"/>
     </target> 
    
    <target name="clean" depends="clean_lib, clean_dist" />
	
	
	<target name="update-dependencies" depends="_load_pom-file, clean_lib">
		<artifact:dependencies filesetId="deps.fileset" >
			<pom refid="pomfile"/>
   		</artifact:dependencies>
   		<unzip dest="lib">
    		<fileset refid="deps.fileset" />
   		</unzip>
	</target>

	<target name="post_update-dependencies">
	</target>
		
	<target name="test">
		<echo message="not implemented yet" />
	</target>

	<target name="publish" depends="mvn_package" />


	<target name="mvn_package" depends="_load_pom-file, clean_dist" >
		<ant antfile="lib/de/bgeb/pandd/package/${pomfile.packaging}.xml" dir="." target="_package">
			 <property name="package_file" value="${pomfile.artifactId}-${pomfile.version}"/>
			 <property name="pandd.used-arche" value="${pandd.used-arche}" />
		</ant>
	</target>
	
	<target name="mvn_install" depends="mvn_package">
		<artifact:install>
			<attach file="dist/${pomfile.artifactId}-${pomfile.version}.jar" type="jar" />
			<pom refid="pomfile"/>
		</artifact:install>
	</target>
	<target name="mvn_deploy" depends="mvn_install" >
	  <artifact:deploy file="dist/${pomfile.artifactId}-${pomfile.version}.jar">
	    <pom refid="pomfile"/>
	  </artifact:deploy>
	</target>
</project>