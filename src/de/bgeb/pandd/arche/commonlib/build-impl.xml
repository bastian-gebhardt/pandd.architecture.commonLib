<!DOCTYPE project>
<project name="pandd_build_impl" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
    	Implementation from Build file for Pandd Framework Developing
    	(there are nothing to configure in this file)
    </description>

	
	
    <!-- Betriebssystemunabhaengige Loesung finden -->
    <exec executable="sed" inputstring="${project_groupId}" outputproperty="project_groupId_as_path">
      <arg value="s/\./\//g"/>
    </exec>
    	
	<target name="setup" depends="_copy_skeleton, _create_packages, _copy_pom, _copy_build-interface">
		<!-- move pandd into lib-folder -->
		<!-- copy skeleton -->
		<!-- create src/groupId/artifactId -->
		<!-- create test/groupId/artifactId -->
		<!-- copy pom -->
		<!-- copy framework build-inteface -->
	</target>
	
	<target name="_copy_skeleton">
		<copy todir=".">
		    <fileset dir="lib/${arche_groupIdAsPath}/${arche_artifactId}/skeleton" includes="**/*" />
		</copy>
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/gitignore" tofile=".gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="lib/.gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="dist/compiled/.gitignore" />
	</target>
	
	<target name="_create_packages">
		<mkdir dir="src/${project_groupId_as_path}/${project_artifactId}" />
		<mkdir dir="test/${project_groupId_as_path}/${project_artifactId}" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="src/${project_groupId_as_path}/${project_artifactId}/.gitignore" />
		<copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/empty_gitignore" tofile="test/${project_groupId_as_path}/${project_artifactId}/.gitignore" />
	</target>

    <target name="_copy_pom">
        <copy file="lib/${arche_groupIdAsPath}/${arche_artifactId}/pom_example.xml" tofile="pom.xml" />
        <replace file="pom.xml" token="@add_project_artifacId_here@" value="${project_artifactId}"/>
        <replace file="pom.xml" token="@add_project_groupId_here@" value="${project_groupId}"/>
        <replace file="pom.xml" token="@add_project_version_here@" value="${project_version}"/>
    	<replace file="pom.xml" token="@add_download_url_here@" value="${mvn_download_repo}"/>
        <replace file="pom.xml" token="@add_upload_url_here@" value="${mvn_upload_repo}"/>
    	<replace file="pom.xml" token="@add_snapshot_download_url_here@" value="${mvn_snapshot_download_repo}"/>
    	<replace file="pom.xml" token="@add_snapshot_upload_url_here@" value="${mvn_snapshot_upload_repo}"/>
    </target>
	
	<target name="_copy_build-interface">
        <copy file="lib/de/bgeb/pandd/framework/build-interface.xml" tofile="build.xml" />
        <replace file="build.xml" token="@add_project_name_here@" value="${project_artifactId}"/>
        <replace file="build.xml" token="@add_build-impl_file_here@" value="lib/${arche_groupIdAsPath}/${arche_artifactId}/build-impl.xml"/>
		
	</target>

	
	
	<target name="_load_pom-file">
		<artifact:pom id="pomfile" file="pom.xml" />
	</target>
	
    <target name="clean_dist">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="dist/compiled" includes="**/*" excludes=".gitignore" />
            <fileset dir="dist" includes="**/*" excludes="compiled/*" />
        </delete>
        <defaultexcludes add="**/.gitignore"/>
    </target> 
    
    <target name="clean_lib">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="lib" includes="**/*" excludes=".gitignore" />
        </delete>       
        <defaultexcludes add="**/.gitignore"/>
     </target> 
    
    <target name="clean" depends="clean_lib, clean_dist" />
	
	
	<target name="update-dependencies" depends="_load_pom-file, clean_lib">
		<artifact:dependencies filesetId="deps.fileset" >
			<pom refid="pomfile"/>
   		</artifact:dependencies>
   		<unzip dest="lib">
    		<fileset refid="deps.fileset" />
   		</unzip>
	</target>

	<target name="test">
		<echo message="not implemented yet" />
	</target>

	<target name="publish">
		<echo message="not implemented yet" />
	</target>

	<target name="m2_package" depends="_load_pom-file, clean_dist" >
		<zip destfile="dist/${pomfile.artifactId}-${pomfile.version}.jar" >
			<zipfileset dir="src/" />
		</zip>
	</target>
	<target name="m2_install" depends="m2_package">
		<artifact:install file="dist/${pomfile.artifactId}-${pomfile.version}.jar">
		    <pom refid="pomfile"/>
		</artifact:install>
	</target>
	<target name="m2_deploy" depends="m2_install" >
	  <artifact:deploy file="dist/${pomfile.artifactId}-${pomfile.version}.jar">
	    <pom refid="pomfile"/>
	  </artifact:deploy>
	</target>
</project>